# Документ требований

## Введение

Система генерации коммерческих предложений — это веб-приложение для создания, управления и распространения профессиональных коммерческих предложений. Система позволяет командам совместно работать над предложениями, использовать базу кейсов, интегрировать мультимедийный контент и генерировать красиво оформленные PDF-документы и веб-страницы для клиентов.

## Глоссарий

- **Система** — веб-приложение для генерации коммерческих предложений
- **Пользователь** — авторизованное лицо, использующее систему
- **Воркспейс** — изолированное рабочее пространство для команды
- **Коммерческое предложение (КП)** — документ с описанием проекта, оценкой, кейсами и условиями
- **Кейс** — описание выполненного проекта с деталями реализации
- **Владелец воркспейса** — пользователь с правами администратора воркспейса
- **Участник воркспейса** — пользователь с доступом к воркспейсу
- **Публичная ссылка** — уникальный URL для просмотра КП клиентом
- **Превью-контент** — изображения или ссылки, прикрепленные к тексту
- **Supabase** — платформа для базы данных и аутентификации
- **Next.js** — фреймворк для разработки веб-приложения
- **Loom** — сервис для записи видео
- **Шаблон КП** — сохраненная структура коммерческого предложения для повторного использования
- **Комментарий** — текстовая заметка участника воркспейса к разделу КП
- **Real-time обновление** — мгновенное отображение изменений для всех участников

## Требования

### Требование 1

**User Story:** Как новый пользователь, я хочу зарегистрироваться и войти в систему, чтобы начать создавать коммерческие предложения.

#### Критерии приемки

1. WHEN пользователь предоставляет валидный email и пароль, THEN Система SHALL создать новый аккаунт пользователя
2. WHEN пользователь вводит корректные учетные данные, THEN Система SHALL аутентифицировать пользователя и предоставить доступ к приложению
3. WHEN пользователь запрашивает сброс пароля, THEN Система SHALL отправить email со ссылкой для восстановления доступа
4. WHEN сессия пользователя истекает, THEN Система SHALL перенаправить пользователя на страницу входа
5. WHEN пользователь вводит невалидные учетные данные, THEN Система SHALL отклонить попытку входа и отобразить сообщение об ошибке

### Требование 2

**User Story:** Как пользователь, я хочу создавать воркспейсы и приглашать в них членов команды, чтобы совместно работать над коммерческими предложениями.

#### Критерии приемки

1. WHEN пользователь создает воркспейс, THEN Система SHALL назначить этого пользователя владельцем воркспейса
2. WHEN владелец воркспейса отправляет приглашение по email, THEN Система SHALL создать уникальную ссылку-приглашение и отправить её указанному получателю
3. WHEN пользователь принимает приглашение, THEN Система SHALL добавить пользователя в список участников воркспейса
4. WHEN владелец воркспейса удаляет участника, THEN Система SHALL отозвать доступ этого участника к воркспейсу
5. WHEN пользователь является участником нескольких воркспейсов, THEN Система SHALL позволить пользователю переключаться между воркспейсами

### Требование 3

**User Story:** Как участник воркспейса, я хочу управлять базой кейсов, чтобы использовать их в коммерческих предложениях.

#### Критерии приемки

1. WHEN участник воркспейса создает кейс, THEN Система SHALL сохранить кейс с названием, описанием, технологиями, результатами и изображениями
2. WHEN участник воркспейса редактирует кейс, THEN Система SHALL обновить данные кейса и сохранить изменения
3. WHEN участник воркспейса удаляет кейс, THEN Система SHALL удалить кейс из базы данных воркспейса
4. WHEN участник воркспейса просматривает список кейсов, THEN Система SHALL отобразить все кейсы воркспейса с возможностью фильтрации и поиска
5. WHEN участник воркспейса загружает изображения для кейса, THEN Система SHALL сохранить изображения и связать их с кейсом

### Требование 4

**User Story:** Как создатель коммерческого предложения, я хочу заполнить все необходимые разделы КП, чтобы предоставить клиенту полную информацию о проекте.

#### Критерии приемки

1. WHEN создатель КП вводит название проекта, THEN Система SHALL сохранить название как заголовок коммерческого предложения
2. WHEN создатель КП указывает таймлайн проекта, THEN Система SHALL сохранить временные рамки выполнения проекта
3. WHEN создатель КП добавляет оценку для специалистов, THEN Система SHALL сохранить информацию о ролях, часах и стоимости для каждого специалиста
4. WHEN создатель КП выбирает кейсы из базы, THEN Система SHALL добавить выбранные кейсы в коммерческое предложение
5. WHEN создатель КП вводит контактную информацию, THEN Система SHALL сохранить контакты для связи с командой
6. WHEN создатель КП описывает процессы разработки, THEN Система SHALL сохранить описание методологии и этапов работы
7. WHEN создатель КП указывает технологический стек, THEN Система SHALL сохранить список используемых технологий
8. WHEN создатель КП добавляет FAQ, THEN Система SHALL сохранить вопросы и ответы в структурированном формате
9. WHEN создатель КП настраивает платежный календарь, THEN Система SHALL сохранить график платежей с суммами и датами

### Требование 5

**User Story:** Как создатель КП, я хочу добавить ссылку на видео-презентацию, чтобы клиент мог просмотреть персонализированное видео.

#### Критерии приемки

1. WHEN создатель КП вводит ссылку на видео (Loom, YouTube, Vimeo), THEN Система SHALL сохранить ссылку в коммерческом предложении
2. WHEN создатель КП удаляет ссылку на видео, THEN Система SHALL удалить ссылку из коммерческого предложения
3. WHEN клиент просматривает КП со ссылкой на видео, THEN Система SHALL отобразить кнопку для открытия видео в новой вкладке

### Требование 6

**User Story:** Как создатель КП, я хочу генерировать публичную ссылку для клиента, чтобы он мог просмотреть коммерческое предложение в браузере.

#### Критерии приемки

1. WHEN создатель КП генерирует публичную ссылку, THEN Система SHALL создать уникальный URL в формате example.com/client-name
2. WHEN клиент открывает публичную ссылку, THEN Система SHALL отобразить коммерческое предложение без требования авторизации
3. WHEN создатель КП изменяет содержимое КП, THEN Система SHALL обновить содержимое по публичной ссылке
4. WHEN создатель КП деактивирует публичную ссылку, THEN Система SHALL запретить доступ к КП по этой ссылке
5. WHEN публичная ссылка содержит невалидный идентификатор, THEN Система SHALL отобразить страницу с сообщением об ошибке

### Требование 7

**User Story:** Как создатель КП, я хочу генерировать PDF-документ по шаблону, чтобы отправить клиенту оформленное коммерческое предложение.

#### Критерии приемки

1. WHEN создатель КП запрашивает генерацию PDF, THEN Система SHALL создать PDF-документ со всем содержимым коммерческого предложения
2. WHEN PDF генерируется, THEN Система SHALL применить профессиональный шаблон оформления с брендингом
3. WHEN PDF содержит изображения, THEN Система SHALL встроить изображения в документ с корректным форматированием
4. WHEN PDF содержит таблицы и списки, THEN Система SHALL отформатировать их читаемым образом
5. WHEN генерация PDF завершена, THEN Система SHALL предоставить ссылку для скачивания документа

### Требование 8

**User Story:** Как создатель КП, я хочу прикреплять превью-контент к тексту, чтобы визуально обогатить описания технологий и процессов.

#### Критерии приемки

1. WHEN создатель КП прикрепляет изображение к тексту, THEN Система SHALL сохранить связь между текстовым блоком и изображением
2. WHEN создатель КП прикрепляет ссылку к тексту, THEN Система SHALL сохранить URL и отобразить его как кликабельный элемент
3. WHEN клиент наводит курсор на текст с превью, THEN Система SHALL отобразить всплывающее окно с изображением или превью ссылки
4. WHEN создатель КП удаляет превью-контент, THEN Система SHALL удалить связь и сохранить только текст
5. WHEN превью-контент загружается, THEN Система SHALL оптимизировать изображения для быстрой загрузки

### Требование 9

**User Story:** Как участник воркспейса, я хочу видеть список всех коммерческих предложений, чтобы управлять ими и отслеживать статус.

#### Критерии приемки

1. WHEN участник воркспейса открывает список КП, THEN Система SHALL отобразить все коммерческие предложения воркспейса
2. WHEN участник воркспейса фильтрует КП по статусу, THEN Система SHALL отобразить только КП с выбранным статусом
3. WHEN участник воркспейса ищет КП по названию, THEN Система SHALL отобразить КП, соответствующие поисковому запросу
4. WHEN участник воркспейса удаляет КП, THEN Система SHALL удалить коммерческое предложение и все связанные данные
5. WHEN участник воркспейса дублирует КП, THEN Система SHALL создать копию коммерческого предложения с новым идентификатором

### Требование 10

**User Story:** Как система, я хочу обеспечить целостность данных и безопасность, чтобы защитить информацию пользователей и клиентов.

#### Критерии приемки

1. WHEN пользователь пытается получить доступ к воркспейсу, THEN Система SHALL проверить права доступа пользователя
2. WHEN пользователь пытается получить доступ к КП другого воркспейса, THEN Система SHALL запретить доступ
3. WHEN данные сохраняются в базу данных, THEN Система SHALL валидировать данные перед сохранением
4. WHEN происходит ошибка при сохранении, THEN Система SHALL откатить транзакцию и сохранить целостность данных
5. WHEN пользователь загружает файлы, THEN Система SHALL проверить тип и размер файла перед сохранением

### Требование 11

**User Story:** Как создатель КП, я хочу сохранять черновики автоматически, чтобы не потерять данные при работе над коммерческим предложением.

#### Критерии приемки

1. WHEN создатель КП редактирует содержимое, THEN Система SHALL автоматически сохранять изменения каждые 30 секунд
2. WHEN создатель КП закрывает браузер без сохранения, THEN Система SHALL сохранить последнюю автоматически сохраненную версию
3. WHEN создатель КП возвращается к редактированию, THEN Система SHALL загрузить последнюю сохраненную версию КП
4. WHEN автосохранение выполняется, THEN Система SHALL отобразить индикатор статуса сохранения

### Требование 12

**User Story:** Как создатель КП, я хочу использовать rich-text редактор, чтобы форматировать текст коммерческого предложения.

#### Критерии приемки

1. WHEN создатель КП форматирует текст, THEN Система SHALL сохранить форматирование (жирный, курсив, подчеркивание, списки)
2. WHEN создатель КП вставляет ссылки, THEN Система SHALL сохранить ссылки как кликабельные элементы
3. WHEN создатель КП вставляет заголовки разных уровней, THEN Система SHALL сохранить иерархию заголовков
4. WHEN форматированный текст отображается в PDF, THEN Система SHALL сохранить форматирование в PDF-документе
5. WHEN форматированный текст отображается по публичной ссылке, THEN Система SHALL отобразить текст с корректным форматированием

### Требование 13

**User Story:** Как участник воркспейса, я хочу создавать и использовать шаблоны КП, чтобы ускорить создание новых коммерческих предложений.

#### Критерии приемки

1. WHEN участник воркспейса сохраняет КП как шаблон, THEN Система SHALL создать шаблон со всей структурой и содержимым КП
2. WHEN участник воркспейса создает КП из шаблона, THEN Система SHALL создать новое КП с содержимым шаблона
3. WHEN участник воркспейса редактирует шаблон, THEN Система SHALL обновить шаблон без изменения существующих КП, созданных из этого шаблона
4. WHEN участник воркспейса удаляет шаблон, THEN Система SHALL удалить шаблон без влияния на существующие КП
5. WHEN участник воркспейса просматривает список шаблонов, THEN Система SHALL отобразить все шаблоны воркспейса с возможностью предпросмотра

### Требование 14

**User Story:** Как участник воркспейса, я хочу оставлять комментарии к разделам КП, чтобы обсуждать детали с командой.

#### Критерии приемки

1. WHEN участник воркспейса добавляет комментарий к разделу КП, THEN Система SHALL сохранить комментарий с указанием автора и времени создания
2. WHEN участник воркспейса отвечает на комментарий, THEN Система SHALL создать вложенный комментарий в треде обсуждения
3. WHEN участник воркспейса удаляет свой комментарий, THEN Система SHALL удалить комментарий из обсуждения
4. WHEN участник воркспейса помечает комментарий как решенный, THEN Система SHALL изменить статус комментария на решенный
5. WHEN участник воркспейса просматривает КП, THEN Система SHALL отобразить количество активных комментариев для каждого раздела

### Требование 15

**User Story:** Как участник воркспейса, я хочу видеть изменения в КП в реальном времени, чтобы эффективно работать совместно с командой.

#### Критерии приемки

1. WHEN участник воркспейса редактирует КП, THEN Система SHALL отобразить изменения другим участникам в течение 2 секунд
2. WHEN несколько участников редактируют разные разделы КП одновременно, THEN Система SHALL синхронизировать все изменения без конфликтов
3. WHEN участник воркспейса открывает КП, THEN Система SHALL отобразить список других участников, работающих с этим КП в данный момент
4. WHEN участник воркспейса редактирует раздел, THEN Система SHALL показать другим участникам индикатор активного редактирования этого раздела
5. WHEN соединение участника прерывается, THEN Система SHALL сохранить локальные изменения и синхронизировать их при восстановлении соединения
